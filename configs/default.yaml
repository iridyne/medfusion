# 实验元数据
project_name: "medical-multimodal"
experiment_name: "resnet18_mlp_gated_v1"
description: "使用 ResNet18 和 MLP 配合门控融合的基线实验"
tags: ["baseline", "resnet", "multimodal"]

# 全局设置
seed: 42
deterministic: true
device: "auto" # "auto", "cuda", "cpu", "mps"

# 数据配置
data:
  # 路径
  data_root: "data"
  csv_path: "data/mock/metadata.csv" # 使用 mock 数据作为默认示例
  image_dir: "data/mock" # 图像根目录

  # 列映射
  image_path_column: "image_path"
  target_column: "diagnosis"
  patient_id_column: "patient_id"

  # 使用的特征（匹配 mock 数据的实际列）
  numerical_features:
    - "age"
  categorical_features:
    - "gender"

  # 数据划分
  train_ratio: 0.7
  val_ratio: 0.15
  test_ratio: 0.15
  random_seed: 42

  # 图像处理
  image_size: 224
  image_channels: 3

  # 数据加载器
  batch_size: 32
  num_workers: 4
  pin_memory: true

  # 数据增强
  augmentation_strength: "medium" # "light", "medium", "heavy"

# 模型架构
model:
  num_classes: 2
  use_auxiliary_heads: true # 为视觉/表格流添加辅助分类器

  # 视觉骨干网络
  vision:
    backbone: "resnet18" # "resnet18", "efficientnet_b0", "vit_b_16" 等
    pretrained: true
    freeze_backbone: true
    feature_dim: 128
    dropout: 0.3
    attention_type: "cbam" # "cbam", "se", "eca", "none"

  # 表格骨干网络
  tabular:
    hidden_dims: [64, 64]
    output_dim: 32
    dropout: 0.2
    use_batch_norm: true
    activation: "relu"

  # 融合模块
  fusion:
    fusion_type: "gated" # "concatenate", "gated", "attention", "cross_attention", "bilinear"
    hidden_dim: 96
    dropout: 0.4
    initial_image_weight: 0.3
    initial_tabular_weight: 0.7

# 训练配置
training:
  num_epochs: 50
  mixed_precision: true
  gradient_clip: 1.0
  label_smoothing: 0.1

  # 渐进式训练
  use_progressive_training: true
  stage1_epochs: 10 # 训练单个流 / 冻结其他流
  stage2_epochs: 20 # 完整微调
  stage3_epochs: 20 # 仅微调融合层（或最终调整）

  # 早停
  early_stopping: true
  patience: 15
  monitor: "val_auc"
  mode: "max"

  # 检查点保存
  save_top_k: 3
  save_last: true

  # 优化器
  optimizer:
    optimizer: "adamw"
    learning_rate: 1.0e-4
    weight_decay: 0.01

    # 差异化学习率
    use_differential_lr: true
    lr_backbone: 1.0e-5
    lr_tabular: 1.0e-3
    lr_fusion: 5.0e-5

  # 学习率调度器
  scheduler:
    scheduler: "cosine"
    warmup_epochs: 5
    min_lr: 1.0e-6

# 日志配置
logging:
  output_dir: "outputs"
  use_tensorboard: true
  use_wandb: false
  wandb_project: "med-core"
  log_every_n_steps: 10
  save_visualizations: true
