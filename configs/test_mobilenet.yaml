# MobileNetV2 骨干网络测试配置
project_name: "med-framework-test"
experiment_name: "mobilenet_test"
description: "使用 MobileNetV2 骨干网络测试框架的即插即用验证"
tags: ["test", "mobilenet", "pluggable"]

# 全局设置
seed: 42
deterministic: true
device: "auto"

# 数据配置
data:
  # 路径
  data_root: "data/mock"
  csv_path: "data/mock/metadata.csv"
  image_dir: "data/mock"

  # 列映射
  image_path_column: "image_path"
  target_column: "diagnosis"
  patient_id_column: "patient_id"

  # 特征
  numerical_features:
    - "age"
  categorical_features:
    - "gender"

  # 数据划分
  train_ratio: 0.6
  val_ratio: 0.2
  test_ratio: 0.2
  random_seed: 42

  # 图像处理
  image_size: 224
  image_channels: 3

  # 数据加载器
  batch_size: 2
  num_workers: 0
  pin_memory: false

  # 数据增强
  augmentation_strength: "light"

# 模型架构
model:
  num_classes: 2
  use_auxiliary_heads: false

  # 视觉骨干网络 - 改为 MOBILENETV2
  vision:
    backbone: "mobilenetv2" # 从 resnet18 改为 mobilenetv2
    pretrained: true
    freeze_backbone: false
    feature_dim: 64
    dropout: 0.3
    attention_type: "cbam" # 使用注意力机制测试

  # 表格骨干网络
  tabular:
    hidden_dims: [32]
    output_dim: 16
    dropout: 0.2
    use_batch_norm: true
    activation: "relu"

  # 融合模块
  fusion:
    fusion_type: "gated" # 从 concatenate 改为 gated 以测试不同融合方式
    hidden_dim: 48
    dropout: 0.3
    initial_image_weight: 0.5
    initial_tabular_weight: 0.5

# 训练配置
training:
  num_epochs: 3
  mixed_precision: false
  gradient_clip: 1.0
  label_smoothing: 0.0

  # 渐进式训练
  use_progressive_training: false
  stage1_epochs: 1
  stage2_epochs: 1
  stage3_epochs: 1

  # 早停
  early_stopping: false
  patience: 5
  monitor: "val_loss"
  mode: "min"

  # 检查点保存
  save_top_k: 1
  save_last: true

  # 优化器
  optimizer:
    optimizer: "adam"
    learning_rate: 0.001
    weight_decay: 0.0001
    use_differential_lr: false

  # 学习率调度器
  scheduler:
    scheduler: "none"
    warmup_epochs: 0
    min_lr: 0.00001

# 日志配置
logging:
  output_dir: "outputs/test_mobilenet"
  use_tensorboard: true
  use_wandb: false
  log_every_n_steps: 1
  save_visualizations: false
