# MedFusion èŠ‚ç‚¹åŒ–å·¥ä½œæµè®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v0.1.0  
**æ—¥æœŸ**: 2026-02-20  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ

## ğŸ“‹ ç›®å½•

- [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
- [å‚è€ƒé¡¹ç›®](#å‚è€ƒé¡¹ç›®)
- [èŠ‚ç‚¹ç±»å‹å®šä¹‰](#èŠ‚ç‚¹ç±»å‹å®šä¹‰)
- [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
- [å·¥ä½œæµæ‰§è¡Œå¼•æ“](#å·¥ä½œæµæ‰§è¡Œå¼•æ“)
- [å·¥ä½œæµä¿å­˜æ ¼å¼](#å·¥ä½œæµä¿å­˜æ ¼å¼)
- [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
- [ç¤ºä¾‹å·¥ä½œæµ](#ç¤ºä¾‹å·¥ä½œæµ)
- [å®ç°è·¯çº¿å›¾](#å®ç°è·¯çº¿å›¾)

---

## è®¾è®¡ç†å¿µ

### æ ¸å¿ƒç›®æ ‡

1. **é›¶ä»£ç æ“ä½œ**: ç”¨æˆ·é€šè¿‡æ‹–æ‹½èŠ‚ç‚¹å’Œè¿çº¿å®Œæˆæ•´ä¸ªè®­ç»ƒæµç¨‹ï¼Œæ— éœ€ç¼–å†™ä»£ç 
2. **å¯è§†åŒ–æ•°æ®æµ**: æ¸…æ™°å±•ç¤ºæ•°æ®åœ¨å„ä¸ªå¤„ç†æ­¥éª¤ä¹‹é—´çš„æµåŠ¨
3. **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œæ˜“äºç†è§£å’Œå¤ç”¨
4. **å·¥ä½œæµå¤ç”¨**: æ”¯æŒä¿å­˜ã€åŠ è½½ã€åˆ†äº«å·¥ä½œæµæ¨¡æ¿
5. **å®æ—¶åé¦ˆ**: èŠ‚ç‚¹æ‰§è¡ŒçŠ¶æ€å®æ—¶æ›´æ–°ï¼Œæ”¯æŒä¸­æ–­å’Œæ¢å¤

### è®¾è®¡åŸåˆ™

- **ç®€å•ä¼˜å…ˆ**: å¸¸ç”¨åœºæ™¯åº”è¯¥åªéœ€è¦ 3-5 ä¸ªèŠ‚ç‚¹
- **æ¸è¿›å¼å¤æ‚**: æ”¯æŒä»ç®€å•åˆ°å¤æ‚çš„å·¥ä½œæµæ„å»º
- **ç±»å‹å®‰å…¨**: èŠ‚ç‚¹è¿æ¥æ—¶è‡ªåŠ¨éªŒè¯æ•°æ®ç±»å‹
- **é”™è¯¯å‹å¥½**: æ¸…æ™°çš„é”™è¯¯æç¤ºå’Œä¿®å¤å»ºè®®
- **æ€§èƒ½ä¼˜åŒ–**: åªé‡æ–°æ‰§è¡Œå˜åŒ–çš„èŠ‚ç‚¹ï¼Œç¼“å­˜ä¸­é—´ç»“æœ

---

## å‚è€ƒé¡¹ç›®

### ComfyUI

**ä¼˜åŠ¿**:
- æˆç†Ÿçš„èŠ‚ç‚¹åŒ–ç•Œé¢ï¼ˆåŸºäº LiteGraph.jsï¼‰
- é«˜æ•ˆçš„æ‰§è¡Œå¼•æ“ï¼ˆåªæ‰§è¡Œå˜åŒ–éƒ¨åˆ†ï¼‰
- å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼ˆcustom_nodesï¼‰
- å·¥ä½œæµä¿å­˜ä¸º JSON æ ¼å¼
- æ”¯æŒä»ç”Ÿæˆçš„å›¾åƒä¸­æå–å·¥ä½œæµ

**å€Ÿé‰´ç‚¹**:
- èŠ‚ç‚¹åŒ–ç•Œé¢è®¾è®¡
- æ•°æ®æµå¯è§†åŒ–
- å·¥ä½œæµä¿å­˜æ ¼å¼
- æ‰§è¡Œå¼•æ“ä¼˜åŒ–ç­–ç•¥

### å†³ç­–é“¾ï¼ˆStatsapeï¼‰

**ä¼˜åŠ¿**:
- ç»Ÿè®¡åˆ†æä¸“ç”¨èŠ‚ç‚¹
- æ¨¡æ¿å¸‚åœºï¼ˆç»Ÿè®¡æµäº‘å¸‚åœºï¼‰
- è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆ
- é›¶ä»£ç æ“ä½œ
- åŒæ¶æ„éƒ¨ç½²ï¼ˆæ¡Œé¢ç‰ˆ + ç½‘é¡µç‰ˆï¼‰

**å€Ÿé‰´ç‚¹**:
- æ¨¡æ¿å¸‚åœºè®¾è®¡
- è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆ
- ç»Ÿè®¡åˆ†æèŠ‚ç‚¹
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### MedFusion çš„å·®å¼‚åŒ–

- **åŒ»å­¦å½±åƒä¸“ç”¨**: æ”¯æŒ DICOMã€NIfTI ç­‰åŒ»å­¦æ ¼å¼
- **å¤šæ¨¡æ€èåˆ**: å›¾åƒ + è¡¨æ ¼æ•°æ®çš„èåˆå¤„ç†
- **æ·±åº¦å­¦ä¹ è®­ç»ƒ**: å®Œæ•´çš„è®­ç»ƒã€éªŒè¯ã€æµ‹è¯•æµç¨‹
- **æ¨¡å‹åº“é›†æˆ**: 29 ç§ Backboneã€5 ç§ Fusion ç­–ç•¥
- **è´¨é‡æ§åˆ¶**: æ•°æ®è´¨é‡æ£€æŸ¥ã€æ¨¡å‹è¯„ä¼°ã€ç»Ÿè®¡æ£€éªŒ

---

## èŠ‚ç‚¹ç±»å‹å®šä¹‰

### 1. æ•°æ®æºèŠ‚ç‚¹ (Data Source Nodes)

#### 1.1 LoadDataset
- **åŠŸèƒ½**: åŠ è½½å·²ä¸Šä¼ çš„æ•°æ®é›†
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `dataset`: Dataset å¯¹è±¡
  - `metadata`: æ•°æ®é›†å…ƒä¿¡æ¯
- **é…ç½®**:
  - `dataset_id`: æ•°æ®é›† IDï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰
  - `split`: æ•°æ®é›†åˆ’åˆ†ï¼ˆtrain/val/test/allï¼‰
  - `shuffle`: æ˜¯å¦æ‰“ä¹±
  - `seed`: éšæœºç§å­

#### 1.2 LoadImage
- **åŠŸèƒ½**: åŠ è½½å•å¼ æˆ–æ‰¹é‡å›¾åƒ
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `images`: å›¾åƒå¼ é‡
  - `paths`: æ–‡ä»¶è·¯å¾„åˆ—è¡¨
- **é…ç½®**:
  - `path`: å›¾åƒè·¯å¾„æˆ–ç›®å½•
  - `format`: å›¾åƒæ ¼å¼ï¼ˆDICOM/NIfTI/PNG/JPGï¼‰
  - `recursive`: æ˜¯å¦é€’å½’æœç´¢

#### 1.3 LoadTabular
- **åŠŸèƒ½**: åŠ è½½è¡¨æ ¼æ•°æ®
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `dataframe`: Pandas DataFrame
  - `columns`: åˆ—ååˆ—è¡¨
- **é…ç½®**:
  - `path`: æ–‡ä»¶è·¯å¾„
  - `format`: æ–‡ä»¶æ ¼å¼ï¼ˆCSV/Excel/JSONï¼‰
  - `encoding`: ç¼–ç æ ¼å¼

### 2. é¢„å¤„ç†èŠ‚ç‚¹ (Preprocessing Nodes)

#### 2.1 ImagePreprocess
- **åŠŸèƒ½**: å›¾åƒé¢„å¤„ç†
- **è¾“å…¥**: 
  - `images`: å›¾åƒå¼ é‡
- **è¾“å‡º**: 
  - `processed_images`: å¤„ç†åçš„å›¾åƒ
- **é…ç½®**:
  - `resize`: ç›®æ ‡å°ºå¯¸ (width, height)
  - `normalize`: å½’ä¸€åŒ–æ–¹æ³•ï¼ˆzscore/minmax/imagenetï¼‰
  - `augmentation`: æ•°æ®å¢å¼ºï¼ˆéšæœºç¿»è½¬ã€æ—‹è½¬ã€è£å‰ªç­‰ï¼‰

#### 2.2 TabularPreprocess
- **åŠŸèƒ½**: è¡¨æ ¼æ•°æ®é¢„å¤„ç†
- **è¾“å…¥**: 
  - `dataframe`: Pandas DataFrame
- **è¾“å‡º**: 
  - `processed_data`: å¤„ç†åçš„æ•°æ®
  - `scaler`: æ ‡å‡†åŒ–å™¨ï¼ˆç”¨äºæ¨ç†ï¼‰
- **é…ç½®**:
  - `missing_strategy`: ç¼ºå¤±å€¼å¤„ç†ï¼ˆdrop/mean/median/modeï¼‰
  - `encoding`: ç±»åˆ«ç¼–ç ï¼ˆonehot/label/targetï¼‰
  - `scaling`: æ•°å€¼ç¼©æ”¾ï¼ˆstandard/minmax/robustï¼‰
  - `feature_selection`: ç‰¹å¾é€‰æ‹©æ–¹æ³•

#### 2.3 DataAugmentation
- **åŠŸèƒ½**: é«˜çº§æ•°æ®å¢å¼º
- **è¾“å…¥**: 
  - `images`: å›¾åƒå¼ é‡
- **è¾“å‡º**: 
  - `augmented_images`: å¢å¼ºåçš„å›¾åƒ
- **é…ç½®**:
  - `methods`: å¢å¼ºæ–¹æ³•åˆ—è¡¨
  - `probability`: åº”ç”¨æ¦‚ç‡
  - `intensity`: å¢å¼ºå¼ºåº¦

### 3. æ¨¡å‹èŠ‚ç‚¹ (Model Nodes)

#### 3.1 SelectBackbone
- **åŠŸèƒ½**: é€‰æ‹©è§†è§‰éª¨å¹²ç½‘ç»œ
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `backbone_config`: Backbone é…ç½®
- **é…ç½®**:
  - `model_name`: æ¨¡å‹åç§°ï¼ˆResNet50/EfficientNet/ViT/Swin ç­‰ï¼‰
  - `pretrained`: æ˜¯å¦ä½¿ç”¨é¢„è®­ç»ƒæƒé‡
  - `freeze_layers`: å†»ç»“å±‚æ•°
  - `output_dim`: è¾“å‡ºç»´åº¦

#### 3.2 SelectFusion
- **åŠŸèƒ½**: é€‰æ‹©èåˆç­–ç•¥
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `fusion_config`: Fusion é…ç½®
- **é…ç½®**:
  - `strategy`: èåˆç­–ç•¥ï¼ˆconcatenate/gated/attention/cross_attention/bilinearï¼‰
  - `hidden_dim`: éšè—å±‚ç»´åº¦
  - `num_heads`: æ³¨æ„åŠ›å¤´æ•°ï¼ˆattention ç­–ç•¥ï¼‰
  - `dropout`: Dropout ç‡

#### 3.3 SelectAggregator
- **åŠŸèƒ½**: é€‰æ‹©å¤šè§†å›¾èšåˆå™¨
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `aggregator_config`: Aggregator é…ç½®
- **é…ç½®**:
  - `method`: èšåˆæ–¹æ³•ï¼ˆmean/max/attention/cross_view/learned_weightï¼‰
  - `learnable`: æ˜¯å¦å¯å­¦ä¹ 
  - `missing_strategy`: ç¼ºå¤±è§†å›¾å¤„ç†

#### 3.4 BuildModel
- **åŠŸèƒ½**: æ„å»ºå®Œæ•´æ¨¡å‹
- **è¾“å…¥**: 
  - `backbone_config`: Backbone é…ç½®
  - `fusion_config`: Fusion é…ç½®
  - `aggregator_config`: Aggregator é…ç½®ï¼ˆå¯é€‰ï¼‰
- **è¾“å‡º**: 
  - `model`: PyTorch æ¨¡å‹
  - `model_summary`: æ¨¡å‹æ‘˜è¦
- **é…ç½®**:
  - `num_classes`: åˆ†ç±»ç±»åˆ«æ•°
  - `task_type`: ä»»åŠ¡ç±»å‹ï¼ˆclassification/regressionï¼‰

### 4. è®­ç»ƒèŠ‚ç‚¹ (Training Nodes)

#### 4.1 ConfigureTraining
- **åŠŸèƒ½**: é…ç½®è®­ç»ƒå‚æ•°
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: 
  - `training_config`: è®­ç»ƒé…ç½®
- **é…ç½®**:
  - `learning_rate`: å­¦ä¹ ç‡
  - `batch_size`: æ‰¹æ¬¡å¤§å°
  - `epochs`: è®­ç»ƒè½®æ•°
  - `optimizer`: ä¼˜åŒ–å™¨ï¼ˆAdam/AdamW/SGDï¼‰
  - `scheduler`: å­¦ä¹ ç‡è°ƒåº¦å™¨
  - `loss_function`: æŸå¤±å‡½æ•°
  - `mixed_precision`: æ··åˆç²¾åº¦è®­ç»ƒ

#### 4.2 TrainModel
- **åŠŸèƒ½**: è®­ç»ƒæ¨¡å‹
- **è¾“å…¥**: 
  - `model`: PyTorch æ¨¡å‹
  - `train_dataset`: è®­ç»ƒæ•°æ®é›†
  - `val_dataset`: éªŒè¯æ•°æ®é›†ï¼ˆå¯é€‰ï¼‰
  - `training_config`: è®­ç»ƒé…ç½®
- **è¾“å‡º**: 
  - `trained_model`: è®­ç»ƒåçš„æ¨¡å‹
  - `training_history`: è®­ç»ƒå†å²
  - `best_checkpoint`: æœ€ä½³æ£€æŸ¥ç‚¹è·¯å¾„
- **é…ç½®**:
  - `early_stopping`: æ—©åœç­–ç•¥
  - `checkpoint_interval`: æ£€æŸ¥ç‚¹ä¿å­˜é—´éš”
  - `log_interval`: æ—¥å¿—è®°å½•é—´éš”

#### 4.3 ResumeTraining
- **åŠŸèƒ½**: ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ
- **è¾“å…¥**: 
  - `checkpoint_path`: æ£€æŸ¥ç‚¹è·¯å¾„
  - `train_dataset`: è®­ç»ƒæ•°æ®é›†
  - `val_dataset`: éªŒè¯æ•°æ®é›†
- **è¾“å‡º**: 
  - `trained_model`: è®­ç»ƒåçš„æ¨¡å‹
  - `training_history`: è®­ç»ƒå†å²

### 5. è¯„ä¼°èŠ‚ç‚¹ (Evaluation Nodes)

#### 5.1 EvaluateModel
- **åŠŸèƒ½**: è¯„ä¼°æ¨¡å‹æ€§èƒ½
- **è¾“å…¥**: 
  - `model`: PyTorch æ¨¡å‹
  - `test_dataset`: æµ‹è¯•æ•°æ®é›†
- **è¾“å‡º**: 
  - `metrics`: è¯„ä¼°æŒ‡æ ‡
  - `predictions`: é¢„æµ‹ç»“æœ
  - `confusion_matrix`: æ··æ·†çŸ©é˜µ
- **é…ç½®**:
  - `metrics`: è¯„ä¼°æŒ‡æ ‡åˆ—è¡¨ï¼ˆaccuracy/precision/recall/f1/aucï¼‰
  - `save_predictions`: æ˜¯å¦ä¿å­˜é¢„æµ‹ç»“æœ

#### 5.2 VisualizeResults
- **åŠŸèƒ½**: å¯è§†åŒ–è¯„ä¼°ç»“æœ
- **è¾“å…¥**: 
  - `metrics`: è¯„ä¼°æŒ‡æ ‡
  - `confusion_matrix`: æ··æ·†çŸ©é˜µ
  - `training_history`: è®­ç»ƒå†å²ï¼ˆå¯é€‰ï¼‰
- **è¾“å‡º**: 
  - `plots`: å›¾è¡¨åˆ—è¡¨
- **é…ç½®**:
  - `plot_types`: å›¾è¡¨ç±»å‹ï¼ˆconfusion_matrix/roc_curve/pr_curve/learning_curveï¼‰
  - `save_path`: ä¿å­˜è·¯å¾„

#### 5.3 GenerateReport
- **åŠŸèƒ½**: ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š
- **è¾“å…¥**: 
  - `metrics`: è¯„ä¼°æŒ‡æ ‡
  - `plots`: å›¾è¡¨åˆ—è¡¨
  - `model_summary`: æ¨¡å‹æ‘˜è¦
- **è¾“å‡º**: 
  - `report_path`: æŠ¥å‘Šæ–‡ä»¶è·¯å¾„
- **é…ç½®**:
  - `format`: æŠ¥å‘Šæ ¼å¼ï¼ˆPDF/Word/HTMLï¼‰
  - `template`: æŠ¥å‘Šæ¨¡æ¿
  - `include_sections`: åŒ…å«çš„ç« èŠ‚

### 6. è¾“å‡ºèŠ‚ç‚¹ (Output Nodes)

#### 6.1 SaveModel
- **åŠŸèƒ½**: ä¿å­˜æ¨¡å‹
- **è¾“å…¥**: 
  - `model`: PyTorch æ¨¡å‹
- **è¾“å‡º**: 
  - `model_path`: æ¨¡å‹ä¿å­˜è·¯å¾„
- **é…ç½®**:
  - `path`: ä¿å­˜è·¯å¾„
  - `format`: ä¿å­˜æ ¼å¼ï¼ˆPyTorch/ONNX/TorchScriptï¼‰
  - `quantization`: é‡åŒ–é€‰é¡¹

#### 6.2 ExportPredictions
- **åŠŸèƒ½**: å¯¼å‡ºé¢„æµ‹ç»“æœ
- **è¾“å…¥**: 
  - `predictions`: é¢„æµ‹ç»“æœ
- **è¾“å‡º**: 
  - `export_path`: å¯¼å‡ºæ–‡ä»¶è·¯å¾„
- **é…ç½®**:
  - `path`: å¯¼å‡ºè·¯å¾„
  - `format`: å¯¼å‡ºæ ¼å¼ï¼ˆCSV/JSON/Excelï¼‰

#### 6.3 SaveWorkflow
- **åŠŸèƒ½**: ä¿å­˜å·¥ä½œæµ
- **è¾“å…¥**: 
  - `workflow`: å½“å‰å·¥ä½œæµ
- **è¾“å‡º**: 
  - `workflow_path`: å·¥ä½œæµä¿å­˜è·¯å¾„
- **é…ç½®**:
  - `path`: ä¿å­˜è·¯å¾„
  - `name`: å·¥ä½œæµåç§°
  - `description`: å·¥ä½œæµæè¿°

### 7. å·¥å…·èŠ‚ç‚¹ (Utility Nodes)

#### 7.1 DataSplit
- **åŠŸèƒ½**: æ•°æ®é›†åˆ’åˆ†
- **è¾“å…¥**: 
  - `dataset`: æ•°æ®é›†
- **è¾“å‡º**: 
  - `train_dataset`: è®­ç»ƒé›†
  - `val_dataset`: éªŒè¯é›†
  - `test_dataset`: æµ‹è¯•é›†
- **é…ç½®**:
  - `train_ratio`: è®­ç»ƒé›†æ¯”ä¾‹
  - `val_ratio`: éªŒè¯é›†æ¯”ä¾‹
  - `test_ratio`: æµ‹è¯•é›†æ¯”ä¾‹
  - `stratify`: æ˜¯å¦åˆ†å±‚é‡‡æ ·
  - `seed`: éšæœºç§å­

#### 7.2 MergeDatasets
- **åŠŸèƒ½**: åˆå¹¶å¤šä¸ªæ•°æ®é›†
- **è¾“å…¥**: 
  - `dataset1`: æ•°æ®é›† 1
  - `dataset2`: æ•°æ®é›† 2
  - `...`: æ›´å¤šæ•°æ®é›†
- **è¾“å‡º**: 
  - `merged_dataset`: åˆå¹¶åçš„æ•°æ®é›†
- **é…ç½®**:
  - `merge_strategy`: åˆå¹¶ç­–ç•¥ï¼ˆconcat/interleaveï¼‰

#### 7.3 FilterData
- **åŠŸèƒ½**: æ•°æ®è¿‡æ»¤
- **è¾“å…¥**: 
  - `dataset`: æ•°æ®é›†
- **è¾“å‡º**: 
  - `filtered_dataset`: è¿‡æ»¤åçš„æ•°æ®é›†
- **é…ç½®**:
  - `filter_condition`: è¿‡æ»¤æ¡ä»¶
  - `filter_column`: è¿‡æ»¤åˆ—ï¼ˆè¡¨æ ¼æ•°æ®ï¼‰

---

## æ•°æ®æµè®¾è®¡

### æ•°æ®ç±»å‹ç³»ç»Ÿ

```python
# åŸºç¡€æ•°æ®ç±»å‹
class DataType(Enum):
    IMAGE = "image"              # å›¾åƒå¼ é‡ (B, C, H, W)
    TABULAR = "tabular"          # è¡¨æ ¼æ•°æ® (DataFrame)
    DATASET = "dataset"          # æ•°æ®é›†å¯¹è±¡
    MODEL = "model"              # PyTorch æ¨¡å‹
    CONFIG = "config"            # é…ç½®å­—å…¸
    METRICS = "metrics"          # è¯„ä¼°æŒ‡æ ‡
    PATH = "path"                # æ–‡ä»¶è·¯å¾„
    TENSOR = "tensor"            # é€šç”¨å¼ é‡
    ANY = "any"                  # ä»»æ„ç±»å‹

# å¤åˆæ•°æ®ç±»å‹
class CompositeDataType:
    MULTIMODAL = [DataType.IMAGE, DataType.TABULAR]  # å¤šæ¨¡æ€æ•°æ®
    TRAINING_DATA = [DataType.DATASET, DataType.CONFIG]  # è®­ç»ƒæ•°æ®
```

### è¿æ¥è§„åˆ™

1. **ç±»å‹åŒ¹é…**: è¾“å‡ºç±»å‹å¿…é¡»ä¸è¾“å…¥ç±»å‹å…¼å®¹
2. **å¤šè¾“å…¥**: èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªè¾“å…¥ç«¯å£
3. **å¤šè¾“å‡º**: èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªè¾“å‡ºç«¯å£
4. **å¯é€‰è¾“å…¥**: æŸäº›è¾“å…¥ç«¯å£å¯ä»¥ä¸ºç©º
5. **ç±»å‹è½¬æ¢**: è‡ªåŠ¨è¿›è¡Œå…¼å®¹ç±»å‹çš„è½¬æ¢

### æ•°æ®æµç¤ºä¾‹

```
LoadDataset â†’ ImagePreprocess â†’ SelectBackbone â†’ BuildModel â†’ TrainModel â†’ EvaluateModel â†’ GenerateReport
                                      â†“              â†“             â†“
                                 SelectFusion â†’ ConfigureTraining
```

---

## å·¥ä½œæµæ‰§è¡Œå¼•æ“

### æ‰§è¡Œç­–ç•¥

#### 1. æ‹“æ‰‘æ’åº
- æ ¹æ®èŠ‚ç‚¹ä¾èµ–å…³ç³»ç¡®å®šæ‰§è¡Œé¡ºåº
- æ£€æµ‹å¾ªç¯ä¾èµ–å¹¶æŠ¥é”™
- æ”¯æŒå¹¶è¡Œæ‰§è¡Œç‹¬ç«‹èŠ‚ç‚¹

#### 2. å¢é‡æ‰§è¡Œ
- åªæ‰§è¡Œå‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹åŠå…¶ä¸‹æ¸¸èŠ‚ç‚¹
- ç¼“å­˜æœªå˜åŒ–èŠ‚ç‚¹çš„è¾“å‡ºç»“æœ
- æ”¯æŒæ‰‹åŠ¨æ ‡è®°èŠ‚ç‚¹ä¸º"éœ€è¦é‡æ–°æ‰§è¡Œ"

#### 3. é”™è¯¯å¤„ç†
- èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥æ—¶åœæ­¢å·¥ä½œæµ
- æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- æ”¯æŒä»å¤±è´¥èŠ‚ç‚¹æ¢å¤æ‰§è¡Œ

#### 4. è¿›åº¦ç›‘æ§
- å®æ—¶æ˜¾ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡ŒçŠ¶æ€
- æ˜¾ç¤ºæ•´ä½“å·¥ä½œæµè¿›åº¦
- æ”¯æŒå–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„å·¥ä½œæµ

### æ‰§è¡ŒçŠ¶æ€

```python
class NodeStatus(Enum):
    PENDING = "pending"          # ç­‰å¾…æ‰§è¡Œ
    RUNNING = "running"          # æ­£åœ¨æ‰§è¡Œ
    SUCCESS = "success"          # æ‰§è¡ŒæˆåŠŸ
    ERROR = "error"              # æ‰§è¡Œå¤±è´¥
    SKIPPED = "skipped"          # è·³è¿‡æ‰§è¡Œ
    CACHED = "cached"            # ä½¿ç”¨ç¼“å­˜ç»“æœ
```

### ç¼“å­˜æœºåˆ¶

```python
# ç¼“å­˜é”®ç”Ÿæˆ
cache_key = hash(node_id + node_config + input_hashes)

# ç¼“å­˜ç­–ç•¥
- å†…å­˜ç¼“å­˜: å°æ•°æ®ï¼ˆé…ç½®ã€æŒ‡æ ‡ç­‰ï¼‰
- ç£ç›˜ç¼“å­˜: å¤§æ•°æ®ï¼ˆæ¨¡å‹ã€æ•°æ®é›†ç­‰ï¼‰
- ç¼“å­˜è¿‡æœŸ: åŸºäºæ—¶é—´æˆ–æ‰‹åŠ¨æ¸…é™¤
```

---

## å·¥ä½œæµä¿å­˜æ ¼å¼

### JSON æ ¼å¼

```json
{
  "version": "1.0.0",
  "metadata": {
    "name": "Chest X-Ray Classification",
    "description": "ä½¿ç”¨ ResNet50 è¿›è¡Œèƒ¸éƒ¨ X å…‰åˆ†ç±»",
    "author": "user@example.com",
    "created_at": "2026-02-20T10:30:00Z",
    "tags": ["classification", "medical-imaging", "resnet"]
  },
  "nodes": [
    {
      "id": "node_1",
      "type": "LoadDataset",
      "position": {"x": 100, "y": 100},
      "config": {
        "dataset_id": "chest-xray-001",
        "split": "train",
        "shuffle": true,
        "seed": 42
      }
    },
    {
      "id": "node_2",
      "type": "ImagePreprocess",
      "position": {"x": 300, "y": 100},
      "config": {
        "resize": [224, 224],
        "normalize": "imagenet",
        "augmentation": ["random_flip", "random_rotation"]
      }
    },
    {
      "id": "node_3",
      "type": "SelectBackbone",
      "position": {"x": 500, "y": 100},
      "config": {
        "model_name": "resnet50",
        "pretrained": true,
        "freeze_layers": 0,
        "output_dim": 512
      }
    }
  ],
  "connections": [
    {
      "id": "conn_1",
      "source": "node_1",
      "source_port": "dataset",
      "target": "node_2",
      "target_port": "images"
    },
    {
      "id": "conn_2",
      "source": "node_2",
      "source_port": "processed_images",
      "target": "node_3",
      "target_port": "input"
    }
  ],
  "execution_history": [
    {
      "timestamp": "2026-02-20T10:35:00Z",
      "status": "success",
      "duration": 300.5,
      "metrics": {
        "accuracy": 0.92,
        "loss": 0.25
      }
    }
  ]
}
```

### .medfusion å·¥ç¨‹æ–‡ä»¶

```
workflow.medfusion
â”œâ”€â”€ workflow.json          # å·¥ä½œæµå®šä¹‰
â”œâ”€â”€ config.yaml           # å…¨å±€é…ç½®
â”œâ”€â”€ checkpoints/          # æ¨¡å‹æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ epoch_10.pth
â”‚   â””â”€â”€ best_model.pth
â”œâ”€â”€ logs/                 # è®­ç»ƒæ—¥å¿—
â”‚   â””â”€â”€ training.log
â”œâ”€â”€ results/              # è¯„ä¼°ç»“æœ
â”‚   â”œâ”€â”€ metrics.json
â”‚   â”œâ”€â”€ confusion_matrix.png
â”‚   â””â”€â”€ report.pdf
â””â”€â”€ cache/                # èŠ‚ç‚¹ç¼“å­˜
    â”œâ”€â”€ node_1.pkl
    â””â”€â”€ node_2.pkl
```

---

## æŠ€æœ¯å®ç°

### å‰ç«¯æŠ€æœ¯æ ˆ

#### ReactFlow
- **ä¼˜åŠ¿**: 
  - React ç”Ÿæ€ï¼Œæ˜“äºé›†æˆ
  - ä¸°å¯Œçš„èŠ‚ç‚¹å’Œè¿çº¿å®šåˆ¶
  - æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€é€‰æ‹©ç­‰äº¤äº’
  - æ´»è·ƒçš„ç¤¾åŒºå’Œæ–‡æ¡£
- **ä½¿ç”¨åœºæ™¯**:
  - èŠ‚ç‚¹ç”»å¸ƒæ¸²æŸ“
  - èŠ‚ç‚¹æ‹–æ‹½å’Œè¿æ¥
  - å·¥ä½œæµå¯è§†åŒ–

#### æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èåº¦ |
|------|------|------|--------|
| ReactFlow | React ç”Ÿæ€ã€æ˜“ç”¨ã€æ–‡æ¡£å¥½ | æ€§èƒ½ä¸€èˆ¬ | â­â­â­â­â­ |
| LiteGraph.js | é«˜æ€§èƒ½ã€ComfyUI ä½¿ç”¨ | é Reactã€æ–‡æ¡£å°‘ | â­â­â­ |
| Rete.js | åŠŸèƒ½å¼ºå¤§ã€æ’ä»¶ä¸°å¯Œ | å­¦ä¹ æ›²çº¿é™¡å³­ | â­â­â­â­ |
| D3.js | å®Œå…¨è‡ªå®šä¹‰ | å¼€å‘æˆæœ¬é«˜ | â­â­ |

**æœ€ç»ˆé€‰æ‹©**: ReactFlowï¼ˆä¸ç°æœ‰ React æŠ€æœ¯æ ˆä¸€è‡´ï¼‰

### åç«¯æŠ€æœ¯æ ˆ

#### å·¥ä½œæµæ‰§è¡Œå¼•æ“

```python
# med_core/workflow/engine.py

class WorkflowEngine:
    def __init__(self):
        self.nodes = {}
        self.connections = []
        self.cache = WorkflowCache()
        
    def add_node(self, node: Node):
        """æ·»åŠ èŠ‚ç‚¹"""
        self.nodes[node.id] = node
        
    def add_connection(self, connection: Connection):
        """æ·»åŠ è¿æ¥"""
        self.validate_connection(connection)
        self.connections.append(connection)
        
    def execute(self, start_node_id: str = None):
        """æ‰§è¡Œå·¥ä½œæµ"""
        # 1. æ‹“æ‰‘æ’åº
        execution_order = self.topological_sort()
        
        # 2. æ‰§è¡ŒèŠ‚ç‚¹
        for node_id in execution_order:
            node = self.nodes[node_id]
            
            # æ£€æŸ¥ç¼“å­˜
            if self.cache.has(node_id):
                node.status = NodeStatus.CACHED
                continue
                
            # æ‰§è¡ŒèŠ‚ç‚¹
            try:
                node.status = NodeStatus.RUNNING
                outputs = node.execute()
                node.status = NodeStatus.SUCCESS
                
                # ç¼“å­˜ç»“æœ
                self.cache.set(node_id, outputs)
            except Exception as e:
                node.status = NodeStatus.ERROR
                node.error = str(e)
                raise
                
    def topological_sort(self) -> List[str]:
        """æ‹“æ‰‘æ’åº"""
        # å®ç°æ‹“æ‰‘æ’åºç®—æ³•
        pass
```

#### èŠ‚ç‚¹åŸºç±»

```python
# med_core/workflow/nodes/base.py

class Node(ABC):
    def __init__(self, node_id: str, node_type: str, config: dict):
        self.id = node_id
        self.type = node_type
        self.config = config
        self.status = NodeStatus.PENDING
        self.inputs = {}
        self.outputs = {}
        self.error = None
        
    @abstractmethod
    def execute(self) -> dict:
        """æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘"""
        pass
        
    @abstractmethod
    def validate(self) -> bool:
        """éªŒè¯èŠ‚ç‚¹é…ç½®"""
        pass
        
    def get_input(self, port_name: str):
        """è·å–è¾“å…¥æ•°æ®"""
        return self.inputs.get(port_name)
        
    def set_output(self, port_name: str, data):
        """è®¾ç½®è¾“å‡ºæ•°æ®"""
        self.outputs[port_name] = data
```

### API ç«¯ç‚¹

```python
# POST /api/workflow/create
# åˆ›å»ºæ–°å·¥ä½œæµ

# GET /api/workflow/{workflow_id}
# è·å–å·¥ä½œæµè¯¦æƒ…

# PUT /api/workflow/{workflow_id}
# æ›´æ–°å·¥ä½œæµ

# POST /api/workflow/{workflow_id}/execute
# æ‰§è¡Œå·¥ä½œæµ

# GET /api/workflow/{workflow_id}/status
# è·å–æ‰§è¡ŒçŠ¶æ€

# POST /api/workflow/{workflow_id}/cancel
# å–æ¶ˆæ‰§è¡Œ

# GET /api/workflow/templates
# è·å–å·¥ä½œæµæ¨¡æ¿åˆ—è¡¨

# POST /api/workflow/import
# å¯¼å…¥å·¥ä½œæµ

# GET /api/workflow/{workflow_id}/export
# å¯¼å‡ºå·¥ä½œæµ
```

---

## ç¤ºä¾‹å·¥ä½œæµ

### ç¤ºä¾‹ 1: ç®€å•å›¾åƒåˆ†ç±»

```
LoadDataset â†’ ImagePreprocess â†’ SelectBackbone â†’ BuildModel â†’ TrainModel â†’ EvaluateModel
                                      â†“              â†“
                                 ConfigureTraining
```

**èŠ‚ç‚¹é…ç½®**:
1. LoadDataset: é€‰æ‹© Chest X-Ray æ•°æ®é›†
2. ImagePreprocess: è°ƒæ•´å¤§å°åˆ° 224x224ï¼ŒImageNet å½’ä¸€åŒ–
3. SelectBackbone: ResNet50ï¼Œé¢„è®­ç»ƒæƒé‡
4. ConfigureTraining: å­¦ä¹ ç‡ 1e-4ï¼Œæ‰¹æ¬¡å¤§å° 32ï¼Œ100 è½®
5. BuildModel: 2 åˆ†ç±»ï¼ˆNormal/Pneumoniaï¼‰
6. TrainModel: è®­ç»ƒæ¨¡å‹
7. EvaluateModel: è®¡ç®—å‡†ç¡®ç‡ã€AUC ç­‰æŒ‡æ ‡

### ç¤ºä¾‹ 2: å¤šæ¨¡æ€èåˆ

```
LoadDataset â†’ ImagePreprocess â†’ SelectBackbone â†˜
                                                  â†’ SelectFusion â†’ BuildModel â†’ TrainModel
LoadTabular â†’ TabularPreprocess ----------------â†—                    â†“
                                                            ConfigureTraining
```

**èŠ‚ç‚¹é…ç½®**:
1. LoadDataset: åŠ è½½å¤šæ¨¡æ€æ•°æ®é›†ï¼ˆå›¾åƒ + ä¸´åºŠæ•°æ®ï¼‰
2. ImagePreprocess: å›¾åƒé¢„å¤„ç†
3. TabularPreprocess: è¡¨æ ¼æ•°æ®é¢„å¤„ç†
4. SelectBackbone: EfficientNet-B0
5. SelectFusion: Gated Fusion
6. ConfigureTraining: å­¦ä¹ ç‡ 1e-3ï¼Œæ‰¹æ¬¡å¤§å° 16
7. BuildModel: æ„å»ºå¤šæ¨¡æ€æ¨¡å‹
8. TrainModel: è®­ç»ƒ

### ç¤ºä¾‹ 3: å¤šè§†å›¾èšåˆ

```
LoadDataset â†’ ImagePreprocess â†’ SelectBackbone â†’ SelectAggregator â†’ BuildModel â†’ TrainModel
   (å¤šè§†å›¾)                                            â†“
                                              ConfigureTraining
```

**èŠ‚ç‚¹é…ç½®**:
1. LoadDataset: åŠ è½½å¤šè§†å›¾æ•°æ®é›†ï¼ˆCT å¤šè§’åº¦ï¼‰
2. ImagePreprocess: ç»Ÿä¸€é¢„å¤„ç†
3. SelectBackbone: Swin Transformer
4. SelectAggregator: Attention Aggregator
5. ConfigureTraining: å­¦ä¹ ç‡ 5e-5ï¼Œæ‰¹æ¬¡å¤§å° 8
6. BuildModel: æ„å»ºå¤šè§†å›¾æ¨¡å‹
7. TrainModel: è®­ç»ƒ

### ç¤ºä¾‹ 4: å®Œæ•´æµç¨‹ï¼ˆæ•°æ® â†’ è®­ç»ƒ â†’ è¯„ä¼° â†’ æŠ¥å‘Šï¼‰

```
LoadDataset â†’ DataSplit â†’ ImagePreprocess â†’ SelectBackbone â†’ BuildModel â†’ TrainModel â†’ EvaluateModel â†’ VisualizeResults â†’ GenerateReport
                â†“                                 â†“              â†“             â†“                                    â†“
              (train)                        SelectFusion  ConfigureTraining                                  SaveModel
                â†“
              (val)
                â†“
              (test)
```

---

## å®ç°è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ï¼ˆ2 å‘¨ï¼‰

**ç›®æ ‡**: å®ç°åŸºæœ¬çš„èŠ‚ç‚¹ç³»ç»Ÿå’Œå·¥ä½œæµæ‰§è¡Œå¼•æ“

- [ ] ReactFlow é›†æˆ
- [ ] èŠ‚ç‚¹åŸºç±»å’Œæ³¨å†Œç³»ç»Ÿ
- [ ] å·¥ä½œæµæ‰§è¡Œå¼•æ“ï¼ˆæ‹“æ‰‘æ’åºã€åŸºæœ¬æ‰§è¡Œï¼‰
- [ ] æ•°æ®ç±»å‹ç³»ç»Ÿå’Œè¿æ¥éªŒè¯
- [ ] å·¥ä½œæµä¿å­˜/åŠ è½½ï¼ˆJSON æ ¼å¼ï¼‰

**äº¤ä»˜ç‰©**:
- å¯ä»¥æ‹–æ‹½èŠ‚ç‚¹å’Œè¿çº¿
- å¯ä»¥æ‰§è¡Œç®€å•çš„å·¥ä½œæµï¼ˆ3-5 ä¸ªèŠ‚ç‚¹ï¼‰
- å¯ä»¥ä¿å­˜å’ŒåŠ è½½å·¥ä½œæµ

### Phase 2: æ ¸å¿ƒèŠ‚ç‚¹ï¼ˆ2 å‘¨ï¼‰

**ç›®æ ‡**: å®ç°å¸¸ç”¨çš„æ ¸å¿ƒèŠ‚ç‚¹

- [ ] æ•°